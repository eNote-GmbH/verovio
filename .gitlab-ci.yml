---
stages:
  # - clang-format
  # - build-xc
  # - build
  # - build-toolkit
  # - build-viewer
  # - deploy-viewer
  # - deploy-editor
  - build-omrc

# variables:
#   EMSCRIPTEN_REPOSITORY: "https://github.com/emscripten-core/emsdk.git"
#   EMSCRIPTEN_DIRECTORY: "emsdk"

# .build-template:
#   stage: build
#   script:
#     - cd tools
#     - cmake ../cmake -DNO_ABC_SUPPORT=ON -DNO_HUMDRUM_SUPPORT=ON -DNO_PAE_SUPPORT=ON
#     - make -j 10

# clang:
#   stage: clang-format
#   tags:
#     - mac-ai
#   script:
#     - clang-format -n -Werror src/*.cpp
#     - clang-format -n -Werror include/vrv/*.h

# build-osx:
#   extends: .build-template
#   tags:
#     - mac-ai

# build-xc-framework:
#   stage: build-xc
#   tags:
#     - mac-ai
#   script:
#     - ./build_xcframework.sh
#   rules:
#     - if: '$CI_COMMIT_REF_NAME == "develop"'

# build-linux:
#   extends: .build-template
#   image:
#     name: rikorose/gcc-cmake
#     entrypoint: [""]

# build-toolkit:
#   stage: build-toolkit
#   image:
#     name: rikorose/gcc-cmake
#     entrypoint: [""]
#   script:
#     - git clone $EMSCRIPTEN_REPOSITORY $EMSCRIPTEN_DIRECTORY
#     - cd $EMSCRIPTEN_DIRECTORY
#     - ./emsdk install latest
#     - ./emsdk activate latest
#     - source emsdk_env.sh
#     - cd ../emscripten
#     - ./buildToolkit -c -H -M
#   artifacts:
#     paths:
#       - emscripten/build/verovio-toolkit.js*

# bridge:
#   stage: deploy-editor
#   only:
#     refs:
#       - enote-stage
#   needs:
#     - build-toolkit
#   trigger:
#     project: Verovio/verovio-humdrum-viewer
#     branch: enote-develop
#     strategy: depend

bridge-omrc:
  stage: build-omrc
  only:
    refs:
      - omrc-python-ci
  # needs:
  #   - build-linux
  trigger:
    project: Verovio/omrc-python
    branch: omrc-python-ci
    strategy: depend